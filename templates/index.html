{% extends "layout.html" %}
{% block content %}

<h2>Simple Expense Tracker</h2>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
      {% for m in messages %}
        <li>{{ m }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<hr/>

<h3>Exchange Rate (Base: USD)</h3>
<p><b>Time stamp:</b> {{ fx_table.timestamp_utc }}</p>

<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>Currency</th>
    <th>1 USD =</th>
  </tr>
  {% for ccy, rate in fx_table.rates.items() %}
    <tr>
      <td>{{ ccy }}</td>
      <td>{{ "%.6f"|format(rate) }}</td>
    </tr>
  {% endfor %}
</table>

<form action="{{ url_for('fx_update') }}" method="POST" style="margin-top:10px;">
  <button type="submit">Fetch FX</button>
</form>

<p style="margin-top:8px;">
  Tip: If you record a non-USD expense, please click <b>Fetch FX</b> first to refresh the table.
</p>

<hr/>

<h3>Add Expense</h3>

<form action="{{ url_for('add_expense') }}" method="POST">
  <label>Category:</label><br/>
  <select name="category" required>
    {% for c in categories %}
      <option value="{{ c }}">{{ c }}</option>
    {% endfor %}
  </select>
  <br/><br/>

  <label>Currency:</label><br/>
  <select name="currency" required>
    {% for ccy in currencies %}
      <option value="{{ ccy }}">{{ ccy }}</option>
    {% endfor %}
  </select>
  <br/><br/>

  <label>Amount:</label><br/>
  <input type="number" step="0.01" name="amount" placeholder="Key in here" required />
  <br/><br/>

  <button type="submit">Submit</button>
</form>

<hr/>

<h3>Recent Records (latest 10)</h3>
{% if recent %}
  <table border="1" cellpadding="6" cellspacing="0">
    <tr>
      <th>UTC Time</th>
      <th>Category</th>
      <th>Amount</th>
      <th>Currency</th>
      <th>USD (converted)</th>
    </tr>
    {% for r in recent %}
      <tr>
        <td>{{ r.created_at_utc }}</td>
        <td>{{ r.category }}</td>
        <td>{{ "%.2f"|format(r.amount) }}</td>
        <td>{{ r.currency }}</td>
        <td>{{ "%.2f"|format(r.amount_usd) }}</td>
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p>No records yet.</p>
{% endif %}

{% endblock %}