{% extends "layout.html" %}
{% block content %}

<h3>Exchange Rate</h3>
<p>
  Time stamp (UTC):
  {% if fx_timestamp %}
    {{ fx_timestamp }}
  {% else %}
    N/A
  {% endif %}
</p>

<table border="1" cellpadding="6">
  <tr>
    <th>Currency</th>
    <th>to USD (1 USD = X currency)</th>
  </tr>
  {% for cur, rate in fx_map.items() %}
  <tr>
    <td>{{ cur }}</td>
    <td>{{ rate }}</td>
  </tr>
  {% endfor %}
</table>

<form action="/fx/update" method="POST" style="margin-top:10px;">
  <button type="submit">Fetch FX (Update from API)</button>
</form>

<hr>

<h3>Add Expense</h3>

<p style="font-size: 13px;">
  Note: The app stores everything in <b>USD</b> for analysis.
  If you enter a non-USD expense, it will convert using the FX table above.
</p>

<form action="/add_expense" method="POST">
  <p><b>Category</b></p>
  {% for c in categories %}
    <label style="margin-right:10px;">
      <input type="radio" name="category" value="{{ c }}" required> {{ c }}
    </label>
  {% endfor %}

  <p>
    <b>Amount</b><br>
    <input type="number" name="amount" step="0.01" placeholder="Key in here" required>
  </p>

  <p>
    <b>Currency</b>
    <select name="currency">
      {% for cur in currencies %}
        <option value="{{ cur }}" {% if cur == "USD" %}selected{% endif %}>{{ cur }}</option>
      {% endfor %}
    </select>
  </p>

  <p>
    <b>Date</b> (optional)<br>
    <input type="date" name="expense_date">
  </p>

  <button type="submit">Submit</button>
</form>

<hr>

<h3>Recent Records (latest 10)</h3>
<table border="1" cellpadding="6">
  <tr>
    <th>ID</th>
    <th>Date</th>
    <th>Category</th>
    <th>Original</th>
    <th>Stored (USD)</th>
  </tr>
  {% for e in recent %}
  <tr>
    <td>{{ e.id }}</td>
    <td>{{ e.expense_date }}</td>
    <td>{{ e.category }}</td>
    <td>{{ "%.2f"|format(e.amount_original) }} {{ e.currency }}</td>
    <td>${{ "%.2f"|format(e.amount_usd) }}</td>
  </tr>
  {% endfor %}
</table>

{% endblock %}